---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data
Loading the data and transform the date variable format; load package
```{r}
acti <- read.csv( unz("activity.zip", filename = "activity.csv") , header = TRUE, sep = ",")
acti$date <- as.Date(acti$date)

library(ggplot2)

```
## What is mean total number of steps taken per day?
Calculate the total steps take per day and its mean and median. Also the histogram of daily steps are plotted.
```{r}
stepDay <- tapply(acti$steps, acti$date, sum, na.rm = TRUE)
stepDayDF <- data.frame(stepTtlDay = stepDay, Day = unique(acti$date))

theme_update(plot.title = element_text(hjust = 0.5))
g <- ggplot(stepDayDF, aes(stepTtlDay))
g + geom_histogram(binwidth = 1000) + labs(x = "Total steps per day", 
                                           title = "Histogram of Total steps taken per day")

stepDayAve <- mean(stepDay, na.rm = T)
stepDayMed <- median(stepDay, na.rm = T)
```
The average daily steps is `r stepDayAve` and the median of daily steps is `r stepDayMed`.

## What is the average daily activity pattern?
```{r}
interval <- strptime(sprintf("%04d", acti$interval),format = "%H%M")
intervalNum <- interval$hour*60 + interval$min
patDaily <- tapply(acti$steps, acti$interval,mean,na.rm = TRUE)
patDailyDF <- data.frame(patternDaily = patDaily, interv = unique(intervalNum))

g <- ggplot(patDailyDF, aes(x = factor(interv), y = patternDaily, group = 1))
g + geom_line(size = 1) + labs(x = "Interval(hour)", y = "Steps", title = "Daily pattern of activity") +
  scale_x_discrete( breaks = as.character(seq(min(intervalNum),max(intervalNum+5),60*6)),
                    labels = as.character(seq(min(intervalNum)/60,max(intervalNum+5)/60,6)) )

maxStep <- max(patDaily)
maxStepInterval <- format(interval[which.max(patDaily)], format = "%H:%M")
```
The daily maximum steps took within one interval is `r maxStep` and the interval is `r maxStepInterval`

## Imputing missing values
```{r}
countNA <- sum(is.na(acti$steps))
# filling the NA value with the mean of that interval
filledData <-data.frame(steps = acti$steps, intv = acti$interval)
stepsFill <- apply(filledData,
                   MARGIN = 1, FUN = function(x, refData = patDailyDF)
                   {
                       if(is.na(x[1]))
                       {
                           x[1] <- refData$patternDaily [which(refData$interv %in% x[2])]
                       }
                   }
)



```



## Are there differences in activity patterns between weekdays and weekends?
